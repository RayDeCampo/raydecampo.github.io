<!doctype html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    
    <title>Lab Notes by Ray DeCampo</title>
    <link rel="icon" type="image/png" href="/favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="/favicon-16x16.png" sizes="16x16" />
    <link rel="stylesheet" href="/assets/css/prism.css">
    <link rel="stylesheet" href="/assets/css/theme.css">
    <link rel="stylesheet" href="/assets/css/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
  </head>
  <body>
    <div class="wrapper">
      <header>
        <ul>
          <li><a href="/posts.html">Posts</a></li>
          <li><a href="/tags.html">Tags</a></li>
          <li><a href="/feeds/posts/default" title="RSS"><i class="svg-icon rss"></i> RSS</a></li>
          <li><a href="/about/">About</a></li>
        </ul>
        <h1 class="header"><a id="homelink" href="/">Lab Notes</a></h1>
        <p class="header">Things I want to remember how to do.</p>
      </header>

      <section>
        

<article class="post">
  <h1>Development Mail Server (CentOS 8)</h1>
  
  <div class="date">
    November  9, 2020
  </div>

  <div class="tags">
  
    <a href="/tags.html#mail">mail</a>
  
    <a href="/tags.html#CentOS">CentOS</a>
  
    <a href="/tags.html#RHEL">RHEL</a>
  
    <a href="/tags.html#postfix">postfix</a>
  
    <a href="/tags.html#dovecot">dovecot</a>
  
    <a href="/tags.html#smtp">smtp</a>
  
    <a href="/tags.html#imap">imap</a>
  
    <a href="/tags.html#thunderbird">thunderbird</a>
  
    <a href="/tags.html#netcat">netcat</a>
  
  </div>
  
  <div class="entry">
    <p>As you are probably aware, any sufficiently developed software application will eventually grow until it implements email.  A frequent stepping stone along that evolutionary path is for an application to gain the ability to send email.  If your application sends email, at a certain point it will become inconvenient to continue to use real email addresses and servers when developing and testing the application.  The solution is to set up a development mail server.</p>
<p>An important note about the development mail server is that it should NOT participate in the delivery or relay of real email.  If you configure it wrong and create an open relay for spam, expect an angry communication from your ISP, usually invoking your name in vain and threatening termination of services.</p>
<p>So the goal here is to create a black hole of email which will accept mail for the configured server only.  Of course, we do want to read the email (at least some of the email) so that we can see that our application is doing what we want.  So we will want to be able to access the email with an IMAP client like Thunderbird.</p>
<p>We'll be running our development mail server on a CentOS 8 server, using postfix as the SMTP server and dovecot as the IMAP server.  We will configure the server to accept mail for the domain <code>example.com</code>, you should change this to whatever domain you use internally for development.  The DNS name for the server will be <code>devmail.example.com</code> and it is assumed this is already configured.</p>
<h2>Firewall</h2>
<p>First things first, configure the firewall to allow SMTP and IMAP traffic.  We use the zone <code>internal</code> for our intranet, you probably use a different zone:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>internal --add-service smtp<br>success<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>internal --add-service imap<br>success<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>internal --add-service smtp --permanent<br>success<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> firewall-cmd --zone<span class="token operator">=</span>internal --add-service imap --permanent<br>success</code></pre>
<h2>Postfix</h2>
<p>Now we are ready to install the postfix server.  We also create an OS user to own the virtual mailboxes.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> dnf <span class="token function">install</span> postfix<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">groupadd</span> --system --gid <span class="token number">2525</span> vmail<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">useradd</span> --system --uid <span class="token number">2525</span> --shell /sbin/nologin --home /var/mail/vhosts --no-user-group -g vmail --comment <span class="token string">"Virtual Mailbox Owner"</span> vmail<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">mkdir</span> -p /var/mail/vhosts/example.com<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">chown</span> -R vmail:vmail /var/mail/vhosts</code></pre>
<p>Next we configure postfix by editing the <code>/etc/postfix/main.cf</code> file.  The <code>myhostname</code> parameter is set to the DNS name, <code>devmail.example.com</code>.  Adjust the <code>inet_interfaces</code> parameter as desired.  (In my case I have <code>devmail</code> defined in the <code>/etc/hosts</code> file to bind it to a specific network interface so I am using <code>devmail, localhost</code>).</p>
<p>Very importantly, set the <code>smtpd_relay_restrictions</code> parameter to <em>reject_unauth_destination</em>.  This will prevent the server from attempting to relay mail to other mail servers.</p>
<p>Finally the virtual mailbox must be configured.  We need to set the <code>virtual_mailbox_domains</code> setting to include our domain, <em>example.com</em>.  The <code>virtual_mailbox_base</code> parameter is set to a directory which will contain the mailboxes.  The <code>virtual_mailbox_maps</code> parameter is set to a file which will contain details about the users and mailboxes the server knows about.  Finally the <code>virtual_uid_maps</code> and <code>virtual_gid_maps</code> are used to tell postfix to use our new <code>vmail</code> OS user when setting the permissions of the mailboxes.</p>
<p>Here is the result of diffing the provided <code>main.cf</code> with the new, configured <code>main.cf</code>:</p>
<pre class="language-diff"><code class="language-diff">[ray@wxyz ~]$ sudo diff main.cf.in main.cf<br><span class="token coord">95a96</span><br><span class="token inserted-arrow inserted"><span class="token prefix inserted">></span><span class="token line"> myhostname = devmail.example.com<br></span></span><span class="token coord">135c136</span><br><span class="token deleted-arrow deleted"><span class="token prefix deleted">&lt;</span><span class="token line"> inet_interfaces = localhost<br></span></span><span class="token coord">---</span><br><span class="token inserted-arrow inserted"><span class="token prefix inserted">></span><span class="token line"> inet_interfaces = devmail, localhost<br></span></span><span class="token coord">316a318,321</span><br><span class="token inserted-arrow inserted"><span class="token prefix inserted">></span><span class="token line"> # Prevent relaying, see /usr/share/doc/postfix/README_FILES/SMTPD_ACCESS_README<br></span><span class="token prefix inserted">></span><span class="token line"> # also postconf(5) man page<br></span><span class="token prefix inserted">></span><span class="token line"> smtpd_relay_restrictions = reject_unauth_destination<br></span><span class="token prefix inserted">></span><span class="token line"><br></span></span><span class="token coord">738a744,753</span><br><span class="token inserted-arrow inserted"><span class="token prefix inserted">></span><span class="token line"><br></span><span class="token prefix inserted">></span><span class="token line"> # VIRTUAL DOMAINS<br></span><span class="token prefix inserted">></span><span class="token line"> # See /usr/share/doc/postfix/README_FILES/VIRTUAL_README, section titled<br></span><span class="token prefix inserted">></span><span class="token line"> # "Postfix virtual MAILBOX example: separate domains, non-UNIX accounts"<br></span><span class="token prefix inserted">></span><span class="token line"> virtual_mailbox_domains = example.com<br></span><span class="token prefix inserted">></span><span class="token line"> virtual_mailbox_base = /var/mail/vhosts<br></span><span class="token prefix inserted">></span><span class="token line"> virtual_mailbox_maps = hash:/etc/postfix/vmailbox<br></span><span class="token prefix inserted">></span><span class="token line"> virtual_uid_maps = static:2525<br></span><span class="token prefix inserted">></span><span class="token line"> virtual_gid_maps = static:2525</code></pre>
<p>One final piece of configuration for postfix is to create the <code>/etc/postfix/vmailbox</code> file.  In our case, instead of creating individual users (who wants to be responsible for administering individual accounts on a development mail server?) we'll create one catchall mailbox that all mail will be routed to.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">cat</span> <span class="token operator">></span>vmailbox <span class="token operator">&lt;&lt;</span><span class="token string">EOF<br>@example.com       example.com/all/Maildir/<br>EOF</span><br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> postmap /etc/postfix/vmailbox</code></pre>
<p>We are ready to enable and start the postfix server:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span>  systemctl <span class="token builtin class-name">enable</span> postfix<br>Created symlink /etc/systemd/system/multi-user.target.wants/postfix.service → /usr/lib/systemd/system/postfix.service.<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span>  systemctl start postfix</code></pre>
<h3>Testing SMTP using netcat</h3>
<p>We can test the postfix server using netcat:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@stinger ~<span class="token punctuation">]</span>$ <span class="token function">nc</span> devmail <span class="token number">25</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOM<br>EHLO STINGER<br>MAIL FROM:auser@example.com<br>RCPT TO:someone@example.com<br>DATA<br>Subject:Testing an email on the new environment<br><br>This is a test of our postfix configuration.<br>.<br>QUIT<br>EOM</span><br><span class="token comment">#</span><br><span class="token number">220</span> devmail.example.com ESMTP Postfix<br><span class="token number">250</span>-devmail.example.com<br><span class="token number">250</span>-PIPELINING<br><span class="token number">250</span>-SIZE <span class="token number">10240000</span><br><span class="token number">250</span>-VRFY<br><span class="token number">250</span>-ETRN<br><span class="token number">250</span>-STARTTLS<br><span class="token number">250</span>-ENHANCEDSTATUSCODES<br><span class="token number">250</span>-8BITMIME<br><span class="token number">250</span>-DSN<br><span class="token number">250</span> SMTPUTF8<br><span class="token number">250</span> <span class="token number">2.1</span>.0 Ok<br><span class="token number">250</span> <span class="token number">2.1</span>.5 Ok<br><span class="token number">354</span> End data with <span class="token operator">&lt;</span>CR<span class="token operator">></span><span class="token operator">&lt;</span>LF<span class="token operator">></span>.<span class="token operator">&lt;</span>CR<span class="token operator">></span><span class="token operator">&lt;</span>LF<span class="token operator">></span><br><span class="token number">250</span> <span class="token number">2.0</span>.0 Ok: queued as EF2DD1D5C89<br><span class="token number">221</span> <span class="token number">2.0</span>.0 Bye</code></pre>
<p>Furthermore we can verify that relaying to another email server fails:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@stinger ~<span class="token punctuation">]</span>$ <span class="token function">nc</span> devmail <span class="token number">25</span> <span class="token operator">&lt;&lt;</span><span class="token string">EOM<br>EHLO STINGER<br>MAIL FROM:auser@example.com<br>RCPT TO:ray@example.net<br>QUIT<br>EOM</span><br><span class="token comment">#</span><br><span class="token number">220</span> devmail.example.com ESMTP Postfix<br><span class="token number">250</span>-devmail.example.com<br><span class="token number">250</span>-PIPELINING<br><span class="token number">250</span>-SIZE <span class="token number">10240000</span><br><span class="token number">250</span>-VRFY<br><span class="token number">250</span>-ETRN<br><span class="token number">250</span>-STARTTLS<br><span class="token number">250</span>-ENHANCEDSTATUSCODES<br><span class="token number">250</span>-8BITMIME<br><span class="token number">250</span>-DSN<br><span class="token number">250</span> SMTPUTF8<br><span class="token number">250</span> <span class="token number">2.1</span>.0 Ok<br><span class="token number">554</span> <span class="token number">5.7</span>.1 <span class="token operator">&lt;</span>ray@example.net<span class="token operator">></span>: Relay access denied<br><span class="token number">221</span> <span class="token number">2.0</span>.0 Bye</code></pre>
<h2>Dovecot</h2>
<h3>Installation and Configuration</h3>
<p>I suppose you would like to be able to read the mail too?  After all, we aren't all perfect coders who get it right on the first try.</p>
<p>In that case, we will set up a dovecot server to provide access to the mailbox via IMAP.</p>
<p>Note the the firewall was already configured to allow IMAP traffic above.  Installing and enabling dovecot involves the usual steps:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> dnf <span class="token function">install</span> dovecot<br><span class="token punctuation">[</span>ray@wxyz ~<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl <span class="token builtin class-name">enable</span> dovecot<br>Created symlink /etc/systemd/system/multi-user.target.wants/dovecot.service → /usr/lib/systemd/system/dovecot.service.</code></pre>
<p>Next we configure authentication to use a custom password file instead of the system authentication by editing the <code>/etc/dovecot/conf.d/10-auth.conf</code> file.  The resulting changes in diff format:</p>
<pre class="language-diff"><code class="language-diff"><span class="token coord">10a11</span><br><span class="token inserted-arrow inserted"><span class="token prefix inserted">></span><span class="token line"> disable_plaintext_auth = no<br></span></span><span class="token coord">122c123</span><br><span class="token deleted-arrow deleted"><span class="token prefix deleted">&lt;</span><span class="token line"> !include auth-system.conf.ext<br></span></span><span class="token coord">---</span><br><span class="token inserted-arrow inserted"><span class="token prefix inserted">></span><span class="token line"> #!include auth-system.conf.ext<br></span></span><span class="token coord">125c126</span><br><span class="token deleted-arrow deleted"><span class="token prefix deleted">&lt;</span><span class="token line"> #!include auth-passwdfile.conf.ext<br></span></span><span class="token coord">---</span><br><span class="token inserted-arrow inserted"><span class="token prefix inserted">></span><span class="token line"> !include auth-passwdfile.conf.ext</code></pre>
<p>Next we tell dovecot where to find our mailbox files by editing <code>/etc/dovecot/conf.d/10-mail.conf</code>, by setting the <code>mail_location</code> parameter:</p>
<pre class="language-diff"><code class="language-diff"><span class="token coord">30c30</span><br><span class="token deleted-arrow deleted"><span class="token prefix deleted">&lt;</span><span class="token line"> #mail_location =<br></span></span><span class="token coord">---</span><br><span class="token inserted-arrow inserted"><span class="token prefix inserted">></span><span class="token line"> mail_location = maildir:/var/mail/vhosts/%d/%n/Maildir</code></pre>
<p>Next we edit the <code>/etc/dovecot/conf.d/auth-passwdfile.conf.ext</code> file.  This was the configuration we activated when editing <code>10-auth.conf</code> and will contain the details of our custom authentication.  The resulting file is small enough to reproduce here (with commented-out lines omitted):</p>
<pre class="language-none"><code class="language-none">passdb {<br>  driver = passwd-file<br>  args = /etc/dovecot/%d-passdb<br>}<br><br>userdb {<br>  driver = static<br>  args = uid=vmail gid=vmail home=/var/mail/vhosts/%d/%n<br>}</code></pre>
<p>We configure dovecot to use the password file in the pattern <code>/etc/dovecot/%d-passwd</code>.  The <code>%d</code> here is a placeholder for the domain, <em>example.com</em>, so out password file will be <code>/etc/dovecot/example.com-passdb</code>.</p>
<p>Since we are not all that concerned about security for our fake email, we can create the password file in plaintext:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@wxyz dovecot<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">cat</span> <span class="token operator">></span>example.com-passdb <span class="token operator">&lt;&lt;</span><span class="token string">EOF<br>all@example.com:{PLAIN}password<br>EOF</span></code></pre>
<p>Now we can start the dovecot server:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@wxyz dovecot<span class="token punctuation">]</span>$ <span class="token function">sudo</span> systemctl start dovecot</code></pre>
<p>Finally, we set up a cron job to delete old mail older than a week old on a weekly basis:</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@wxyz dovecot<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">cat</span> <span class="token operator">></span>/etc/cron.weekly/delete-old-mail <span class="token operator">&lt;&lt;</span><span class="token string">EOF<br>#!/bin/bash<br>threshold=<span class="token variable"><span class="token variable">$(</span> <span class="token function">date</span> --date<span class="token operator">=</span><span class="token string">'last week'</span> <span class="token string">'+%d-%b-%Y'</span> <span class="token variable">)</span></span><br>doveadm expunge -u all@example.com mailbox INBOX SENTBEFORE <span class="token variable">${threshold}</span><br>doveadm purge -u all@example.com<br>EOF</span><br><span class="token punctuation">[</span>ray@wxyz dovecot<span class="token punctuation">]</span>$ <span class="token function">sudo</span> <span class="token function">chmod</span> <span class="token number">744</span> /etc/cron.weekly/delete-old-mail</code></pre>
<h3>Testing via OpenSSL</h3>
<p>Since dovecot will use the STARTTLS protocol by default, we can't just connect to it via netcat like postfix.  We need to use openssl, which supports encrypted traffic and specifically the STARTTLS protocol.</p>
<p>Below is an example session showing how to use openssl to make the connection.  The commands entered interactively all start with a<em>n</em>, where <em>n</em> is a number.  I've edited down some of the output from the server.</p>
<pre class="language-shell"><code class="language-shell"><span class="token punctuation">[</span>ray@stinger ~<span class="token punctuation">]</span>$ openssl s_client -connect devmail:143 -starttls imap<br>CONNECTED<span class="token punctuation">(</span>00000003<span class="token punctuation">)</span><br><span class="token assign-left variable">depth</span><span class="token operator">=</span><span class="token number">0</span> OU <span class="token operator">=</span> IMAP server, CN <span class="token operator">=</span> imap.example.com, emailAddress <span class="token operator">=</span> postmaster@example.com<br>verify error:num<span class="token operator">=</span><span class="token number">18</span>:self signed certificate<br>verify return:1<br><span class="token assign-left variable">depth</span><span class="token operator">=</span><span class="token number">0</span> OU <span class="token operator">=</span> IMAP server, CN <span class="token operator">=</span> imap.example.com, emailAddress <span class="token operator">=</span> postmaster@example.com<br>verify return:1<br>---<br>Certificate chain<br> <span class="token number">0</span> s:/OU<span class="token operator">=</span>IMAP server/CN<span class="token operator">=</span>imap.example.com/emailAddress<span class="token operator">=</span>postmaster@example.com<br>   i:/OU<span class="token operator">=</span>IMAP server/CN<span class="token operator">=</span>imap.example.com/emailAddress<span class="token operator">=</span>postmaster@example.com<br>---<br>Server certificate<br>-----BEGIN CERTIFICATE-----<br>MIIEUzCCArugAwIBAgIUJLx3lRtnTxo0WoCjsTsRhEQklZMwDQYJKoZIhvcNAQEL<br><span class="token assign-left variable">duHQueW0oQ</span><span class="token operator">==</span><br>-----END CERTIFICATE-----<br><span class="token assign-left variable">subject</span><span class="token operator">=</span>/OU<span class="token operator">=</span>IMAP server/CN<span class="token operator">=</span>imap.example.com/emailAddress<span class="token operator">=</span>postmaster@example.com<br><span class="token assign-left variable">issuer</span><span class="token operator">=</span>/OU<span class="token operator">=</span>IMAP server/CN<span class="token operator">=</span>imap.example.com/emailAddress<span class="token operator">=</span>postmaster@example.com<br>---<br>No client certificate CA names sent<br>Peer signing digest: SHA512<br>Server Temp Key: ECDH, P-256, <span class="token number">256</span> bits<br>---<br>SSL handshake has <span class="token builtin class-name">read</span> <span class="token number">2208</span> bytes and written <span class="token number">441</span> bytes<br>---<br>New, TLSv1/SSLv3, Cipher is ECDHE-RSA-AES256-GCM-SHA384<br>Server public key is <span class="token number">3072</span> bit<br>Secure Renegotiation IS supported<br>Compression: NONE<br>Expansion: NONE<br>No ALPN negotiated<br>SSL-Session:<br>    Protocol  <span class="token builtin class-name">:</span> TLSv1.2<br>    Cipher    <span class="token builtin class-name">:</span> ECDHE-RSA-AES256-GCM-SHA384<br>    Session-ID: 37D8B6A46719F7C0D16D122C8E6<br>    Session-ID-ctx:<br>    Master-Key: 2E69D75A3D0B2A6CB4AECCAA5A3<br>    Key-Arg   <span class="token builtin class-name">:</span> None<br>    Krb5 Principal: None<br>    PSK identity: None<br>    PSK identity hint: None<br>    TLS session ticket lifetime hint: <span class="token number">7200</span> <span class="token punctuation">(</span>seconds<span class="token punctuation">)</span><br>    TLS session ticket:<br>    0000 - <span class="token number">95</span> 4e 5a b2 c3 a7 <span class="token number">89</span> 8b-42 <span class="token number">49</span> 07 2b bb 6f <span class="token number">57</span> 6c   .NZ<span class="token punctuation">..</span><span class="token punctuation">..</span>.BI.+.oWl<br>    0010 - ef <span class="token number">69</span> 9b <span class="token number">92</span> 2f f3 aa 5d-a7 <span class="token number">51</span> 6d <span class="token number">77</span> 2c b4 4c <span class="token number">19</span>   .i<span class="token punctuation">..</span>/<span class="token punctuation">..</span><span class="token punctuation">]</span>.Qmw,.L.<br>    0020 - 03 <span class="token function">dd</span> e8 5f 5e <span class="token number">23</span> 6b dd-dd <span class="token number">41</span> <span class="token function">df</span> <span class="token number">48</span> <span class="token number">65</span> c8 d0 <span class="token number">50</span>   <span class="token punctuation">..</span>._^<span class="token comment">#k..A.He..P</span><br>    0030 - d3 e5 f6 cc <span class="token number">72</span> 05 cf 6f-c3 b0 f3 <span class="token number">11</span> <span class="token number">83</span> ff eb <span class="token number">74</span>   <span class="token punctuation">..</span><span class="token punctuation">..</span>r<span class="token punctuation">..</span>o<span class="token punctuation">..</span><span class="token punctuation">..</span><span class="token punctuation">..</span>.t<br><br>    Start Time: <span class="token number">1594842880</span><br>    Timeout   <span class="token builtin class-name">:</span> <span class="token number">300</span> <span class="token punctuation">(</span>sec<span class="token punctuation">)</span><br>    Verify <span class="token builtin class-name">return</span> code: <span class="token number">18</span> <span class="token punctuation">(</span>self signed certificate<span class="token punctuation">)</span><br>---<br><span class="token builtin class-name">.</span> OK Pre-login capabilities listed, post-login capabilities have more.<br><br>a1 LOGIN all@example.com p<br>* CAPABILITY IMAP4rev1 SASL-IR LOGIN-REFERRALS ID ENABLE IDLE SORT<br><span class="token assign-left variable">SORT</span><span class="token operator">=</span><span class="token environment constant">DISPLAY</span> <span class="token assign-left variable">THREAD</span><span class="token operator">=</span>REFERENCES <span class="token assign-left variable">THREAD</span><span class="token operator">=</span>REFS <span class="token assign-left variable">THREAD</span><span class="token operator">=</span>ORDEREDSUBJECT<br>MULTIAPPEND URL-PARTIAL CATENATE UNSELECT CHILDREN NAMESPACE UIDPLUS<br>LIST-EXTENDED <span class="token assign-left variable">I18NLEVEL</span><span class="token operator">=</span><span class="token number">1</span> CONDSTORE QRESYNC ESEARCH ESORT SEARCHRES<br>WITHIN <span class="token assign-left variable">CONTEXT</span><span class="token operator">=</span>SEARCH LIST-STATUS BINARY MOVE <span class="token assign-left variable">SNIPPET</span><span class="token operator">=</span>FUZZY<br><span class="token assign-left variable">PREVIEW</span><span class="token operator">=</span>FUZZY LITERAL+ NOTIFY SPECIAL-USE<br>a1 OK Logged <span class="token keyword">in</span><br><br>a2 LIST <span class="token string">""</span> <span class="token string">"*"</span><br>* LIST <span class="token punctuation">(</span><span class="token punctuation">\</span>HasNoChildren<span class="token punctuation">)</span> <span class="token string">"."</span> INBOX<br>a2 OK List completed <span class="token punctuation">(</span><span class="token number">0.001</span> + <span class="token number">0.000</span> secs<span class="token punctuation">)</span>.<br><br>a3 EXAMINE INBOX<br>* FLAGS <span class="token punctuation">(</span><span class="token punctuation">\</span>Answered <span class="token punctuation">\</span>Flagged <span class="token punctuation">\</span>Deleted <span class="token punctuation">\</span>Seen <span class="token punctuation">\</span>Draft<span class="token punctuation">)</span><br>* OK <span class="token punctuation">[</span>PERMANENTFLAGS <span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> Read-only mailbox.<br>* <span class="token number">1</span> EXISTS<br>* <span class="token number">1</span> RECENT<br>* OK <span class="token punctuation">[</span>UNSEEN <span class="token number">1</span><span class="token punctuation">]</span> First unseen.<br>* OK <span class="token punctuation">[</span>UIDVALIDITY <span class="token number">1594842093</span><span class="token punctuation">]</span> UIDs valid<br>* OK <span class="token punctuation">[</span>UIDNEXT <span class="token number">2</span><span class="token punctuation">]</span> Predicted next <span class="token environment constant">UID</span><br>a3 OK <span class="token punctuation">[</span>READ-ONLY<span class="token punctuation">]</span> Examine completed <span class="token punctuation">(</span><span class="token number">0.002</span> + <span class="token number">0.000</span> + <span class="token number">0.001</span> secs<span class="token punctuation">)</span>.<br><br>a4 FETCH <span class="token number">1</span> BODY<span class="token punctuation">[</span><span class="token punctuation">]</span><br>* <span class="token number">1</span> FETCH <span class="token punctuation">(</span>BODY<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">{</span><span class="token number">405</span><span class="token punctuation">}</span><br>Return-Path: <span class="token operator">&lt;</span>auser@example.com<span class="token operator">></span><br>X-Original-To: someone@example.com<br>Delivered-To: someone@example.com<br>Received: from STINGER <span class="token punctuation">(</span>unknown <span class="token punctuation">[</span><span class="token number">10.0</span>.0.200<span class="token punctuation">]</span><span class="token punctuation">)</span><br>        by devmail.prosoft.prosoftcm.com <span class="token punctuation">(</span>Postfix<span class="token punctuation">)</span> with ESMTP <span class="token function">id</span> EF2DD1D5C89<br>        <span class="token keyword">for</span> <span class="token operator">&lt;</span>someone@example.com<span class="token operator">></span><span class="token punctuation">;</span> Wed, <span class="token number">15</span> Jul <span class="token number">2020</span> <span class="token number">15</span>:03:53 -0400 <span class="token punctuation">(</span>EDT<span class="token punctuation">)</span><br>Subject:Testing an email on the new environment<br><br>This is a <span class="token builtin class-name">test</span> of our postfix configuration.<br><span class="token punctuation">)</span><br>a4 OK Fetch completed <span class="token punctuation">(</span><span class="token number">0.002</span> + <span class="token number">0.000</span> + <span class="token number">0.001</span> secs<span class="token punctuation">)</span>.<br><br>a5 LOGOUT<br>* BYE Logging out<br>a5 OK Logout completed <span class="token punctuation">(</span><span class="token number">0.001</span> + <span class="token number">0.000</span> secs<span class="token punctuation">)</span>.<br>closed</code></pre>
<p>Our command line test is successful.  It should be possible to configure an IMAP client like Thunderbird to read the mailbox.  Keep in mind many IMAP clients try to make configuration easy by using DNS settings which (presumably) won't exist for your development mail server.</p>

  </div>
</article>

      </section>

      <footer>
        <div>Ray DeCampo</div>
        <div>
          <a href="https://github.com/RayDeCampo" title="GitHub"><i class="svg-icon github"></i></a>
          <a href="https://twitter.com/iamdoingitwrong" title="Twitter"><i class="svg-icon twitter"></i></a>
          <a href="https://www.linkedin.com/in/raymonddecampo/" title="LinkedIn"><i class="svg-icon linkedin"></i></a>
        </div>
      </footer>
    </div>
  </body>
</html>
