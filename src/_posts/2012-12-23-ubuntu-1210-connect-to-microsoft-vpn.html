---
layout: post
title: 'Ubuntu 12.10: Connect to Microsoft VPN'
date: '2012-12-23T09:30:00.000-05:00'
permalink: 2012/12/23/{{ page.fileSlug }}.html
author: Raymond DeCampo
tags:
- ubuntu
- Windows
- quantal
- vpn
modified_time: '2014-07-13T17:35:18.911-04:00'
blogger_id: tag:blogger.com,1999:blog-6427287440000636763.post-5133917589680955594
blogger_orig_url: http://labnotes.decampo.org/2012/12/ubuntu-1210-connect-to-microsoft-vpn.html
redirect_from: /2012/12/ubuntu-1210-connect-to-microsoft-vpn.html
excerpt_separator: </p>
---

<p>I recently upgraded to Ubuntu 12.10 on my main desktop machine from scratch, which means a number of things which had been installed and configured need to be re-done.  One of those things is my VPN connection to work, which runs Windows 2008 Server for VPN.</p>
<p>If you have ever tried to configure a linux machine to connect to a Microsoft-based VPN, you know that it is not as straightforward as it could be.  It is more of a voodoo ritual than a science.  I figured it would be a good idea to capture the steps for future reference.</p>
<p>This first part is adapted from the Ubuntu Wiki for posterity.  You can check out the original at <a href="https://wiki.ubuntu.com/VPN">https://wiki.ubuntu.com/VPN</a> under the heading <em>VPN setup in Ubuntu 9.10</em>.  Apparently this originates from a Ubuntu forums post by user sweisler at <a href="http://ubuntuforums.org/showpost.php?p=8261958&amp;postcount=6">http://ubuntuforums.org/showpost.php?p=8261958&amp;postcount=6</a>.  Thanks sweisler, wherever you are.</p>
<p>First, there was no need to install any additional packages, apparently everything needed is included by default.</p>
<ul><li>Open VPN configuration screen: <ul><li>Click on the network icon in the upper right of the desktop </li><li>Go to the <em>VPN Connections</em> menu </li><li>Select <em>Configure VPN&#8230;</em></li></ul></li><li>Add a new PPTP connection </li><li>On the VPN tab, set the following: <ul><li><em>Connection name</em> (whatever you want) </li><li>Uncheck <em>Connect automatically</em> (you can change this later) </li><li><em>Gateway</em> (this is the VPN server) </li><li><em>User name</em> (for domain-based user accounts, use domain\username) </li><li>Do <strong>not</strong> set <em>Password</em>; <strong>do</strong> change the pulldown to <em>Always Ask</em></li><li>Do <strong>not</strong> set <em>NT Domain</em></li><li>Uncheck <em>Available to all users</em> (this works either way, but I am assuming you don&#8217;t really want your kid to have access to the VPN) </li></ul></li><li>PPTP Advanced Options (Advanced button from the VPN tab) <ul><li>Uncheck all authentication methods <strong>except</strong> <em>MSCHAPv2</em></li><li>Check <em>Use Point-to-Point encryption (MPPE)</em></li><li>Leave <em>Security</em> set at <em>All Available (Default)</em></li><li>Check <em>Allow stateful inspection</em></li><li>Uncheck <em>Allow BSD data compression</em></li><li>Uncheck <em>Allow Deflate data compression</em></li><li>Uncheck <em>Use TCP header compression</em></li><li>Uncheck <em>Send PPP echo packets</em> (this setting works either way, check it for debugging purposes) </li></ul></li></ul><p>At this point save it and test it.  Once the VPN connection is working you may want to try to tweak it further as described below.</p>
<p>One problem with the VPN I connect to is that all traffic ends up using the VPN when I am connected.  This is less than ideal if you are connecting to servers on the internet while the VPN is connected since the traffic goes through the VPN server before coming to you.  The following describes the settings for routing only the proper traffic to the VPN.  (Read them all the way through first to make sure you have all the necessary information.)</p>
<ul><li>On the <em>IPv4 Settings</em> tab <ul><li>Set <em>Additional DNS servers</em> using the IP address of the DNS server for the VPN.  (You may need to ask your IT guy for this; there should be a way to discover it when connecting as above but it escapes me.) </li><li>Set <em>Additional search domains</em>.  Set this to the domain suffix of the machines on the VPN.  For example, if the machines like dbserver.example.com then set it to example.com. </li></ul></li><li>Click the <em>Routes</em> button. <ul><li>Check <em>Use this connection only for resources on its network</em></li><li><em>Add</em> a route: <ul><li>For <em>Address</em>, use the internal IP address of the VPN server applied against the netmask below, e.g. if the VPN server is 10.0.0.10 and the netmask is 255.255.255.0, use 10.0.0.0 (this is different in 14.04, in the past one could just use the IP of the VPN server).  Again, this should be the <strong>internal</strong> IP address for getting to the machine in the intranet, not the external IP address for getting to the machine from the internet. </li><li>For <em>Netmask</em>, use the netmask of your intranet.  (If you are confused, ask your IT guy what to use for both this and the <em>Address</em>.)  For most networks this will be 255.255.255.0, but for many it will be different. </li><li>For <em>Gateway</em>, use the external IP address of the VPN server.  This should match the <em>Gateway</em> defined on the VPN tab.  (I&#8217;m not sure what happens if you are using a server name there.  I suspect you should match the names, but you may need to experiment.) </li><li>Do not set the <em>Metric</em> unless you know what you are doing. </li></ul></li></ul></li></ul><p>OK, so now when you connect you should see regular traffic going directly to the internet and intranet traffic directed to the VPN server.  You can test this out with <tt>traceroute</tt> (which you may need to install).  You should also be able to refer to machines on the intranet using their short names (e.g. dbserver instead of dbserver.example.com).</p>
<p>Let me know how these instructions work for you and what type of systems you&#8217;ve been able to connect.</p>
